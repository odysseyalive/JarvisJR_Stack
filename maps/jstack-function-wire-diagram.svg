<?xml version="1.0" encoding="UTF-8"?>
<svg width="1440" height="890" xmlns="http://www.w3.org/2000/svg">
  <!-- Mathematical grid background (8px base) -->
  <defs>
    <pattern id="grid8" width="8" height="8" patternUnits="userSpaceOnUse">
      <path d="M 8 0 L 0 0 0 8" fill="none" stroke="#f5f5f5" stroke-width="0.5"/>
    </pattern>
    <!-- Arrow markers -->
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2196f3"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4caf50"/>
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800"/>
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#9c27b0"/>
    </marker>
    <!-- Data flow gradient -->
    <linearGradient id="dataFlow" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#e3f2fd;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#bbdefb;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- Grid background -->
  <rect width="100%" height="100%" fill="url(#grid8)"/>
  
  <!-- Main Title -->
  <text x="720" y="34" font-family="Arial, sans-serif" font-size="34" text-anchor="middle" font-weight="bold" fill="#1565c0">
    JarvisJR Stack - Function Wire Diagram
  </text>
  
  <!-- Subtitle -->
  <text x="720" y="55" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#424242">
    Comprehensive mapping of function calls, data flows, and module dependencies
  </text>
  
  <!-- Legend -->
  <g id="legend" transform="translate(89, 89)">
    <rect x="0" y="0" width="610" height="144" fill="#fafafa" stroke="#e0e0e0" stroke-width="1" rx="5"/>
    <text x="13" y="21" font-family="Arial, sans-serif" font-size="16" font-weight="bold">Legend</text>
    
    <!-- Function types -->
    <rect x="13" y="34" width="21" height="13" fill="#2196f3" rx="2"/>
    <text x="42" y="42" font-family="Arial, sans-serif" font-size="11">Main Entry Point</text>
    
    <rect x="144" y="34" width="21" height="13" fill="#4caf50" rx="2"/>
    <text x="173" y="42" font-family="Arial, sans-serif" font-size="11">Core Module</text>
    
    <rect x="275" y="34" width="21" height="13" fill="#ff9800" rx="2"/>
    <text x="304" y="42" font-family="Arial, sans-serif" font-size="11">Utility Library</text>
    
    <rect x="406" y="34" width="21" height="13" fill="#9c27b0" rx="2"/>
    <text x="435" y="42" font-family="Arial, sans-serif" font-size="11">Configuration</text>
    
    <!-- Flow types -->
    <line x1="13" y1="68" x2="34" y2="68" stroke="#2196f3" stroke-width="2" marker-end="url(#arrowhead-blue)"/>
    <text x="42" y="72" font-family="Arial, sans-serif" font-size="11">Function Call</text>
    
    <line x1="144" y1="68" x2="165" y2="68" stroke="#4caf50" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrowhead-green)"/>
    <text x="173" y="72" font-family="Arial, sans-serif" font-size="11">Config Data Flow</text>
    
    <line x1="275" y1="68" x2="296" y2="68" stroke="#ff9800" stroke-width="3"/>
    <text x="304" y="72" font-family="Arial, sans-serif" font-size="11">Error/Logging Path</text>
    
    <line x1="406" y1="68" x2="427" y2="68" stroke="#9c27b0" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrowhead-purple)"/>
    <text x="435" y="72" font-family="Arial, sans-serif" font-size="11">Environment Export</text>
    
    <!-- Data Types -->
    <circle cx="23" cy="102" r="8" fill="#e8f5e8" stroke="#4caf50"/>
    <text x="42" y="106" font-family="Arial, sans-serif" font-size="11">Variable Birth</text>
    
    <circle cx="154" cy="102" r="8" fill="#fff3e0" stroke="#ff9800"/>
    <text x="173" y="106" font-family="Arial, sans-serif" font-size="11">Variable Transform</text>
    
    <circle cx="285" cy="102" r="8" fill="#fce4ec" stroke="#e91e63"/>
    <text x="304" y="106" font-family="Arial, sans-serif" font-size="11">Validation Point</text>
    
    <rect x="406" y="120" width="189" height="13" fill="url(#dataFlow)" stroke="#2196f3" rx="2"/>
    <text x="410" y="129" font-family="Arial, sans-serif" font-size="10">Configuration Data Flow Path</text>
  </g>
  
  <!-- Main Architecture Layers -->
  
  <!-- Layer 1: Main Entry Point -->
  <g id="main-entry" transform="translate(89, 277)">
    <rect x="0" y="0" width="1262" height="89" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="13" y="21" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1565c0">
      Layer 1: Main Entry Point (jstack.sh)
    </text>
    
    <!-- Main function box -->
    <rect x="21" y="34" width="233" height="42" fill="#2196f3" stroke="#1565c0" stroke-width="1" rx="3"/>
    <text x="28" y="47" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">main()</text>
    <text x="28" y="58" font-family="Arial, sans-serif" font-size="9" fill="#e3f2fd">CLI argument parsing & routing</text>
    <text x="28" y="69" font-family="Arial, sans-serif" font-size="9" fill="#e3f2fd">Command delegation to modules</text>
    
    <!-- Command routing functions -->
    <rect x="275" y="34" width="144" height="42" fill="#1e88e5" stroke="#1565c0" stroke-width="1" rx="3"/>
    <text x="282" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">run_installation()</text>
    <text x="282" y="58" font-family="Arial, sans-serif" font-size="8" fill="#e3f2fd">Orchestrates full install</text>
    
    <rect x="440" y="34" width="144" height="42" fill="#1e88e5" stroke="#1565c0" stroke-width="1" rx="3"/>
    <text x="447" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">run_uninstallation()</text>
    <text x="447" y="58" font-family="Arial, sans-serif" font-size="8" fill="#e3f2fd">Complete system removal</text>
    
    <rect x="605" y="34" width="144" height="42" fill="#1e88e5" stroke="#1565c0" stroke-width="1" rx="3"/>
    <text x="612" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">run_backup()</text>
    <text x="612" y="58" font-family="Arial, sans-serif" font-size="8" fill="#e3f2fd">System state backup</text>
    
    <rect x="770" y="34" width="144" height="42" fill="#1e88e5" stroke="#1565c0" stroke-width="1" rx="3"/>
    <text x="777" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">run_restore()</text>
    <text x="777" y="58" font-family="Arial, sans-serif" font-size="8" fill="#e3f2fd">System state restore</text>
    
    <rect x="935" y="34" width="144" height="42" fill="#1e88e5" stroke="#1565c0" stroke-width="1" rx="3"/>
    <text x="942" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">add_site()</text>
    <text x="942" y="58" font-family="Arial, sans-serif" font-size="8" fill="#e3f2fd">Site management</text>
    
    <rect x="1100" y="34" width="144" height="42" fill="#1e88e5" stroke="#1565c0" stroke-width="1" rx="3"/>
    <text x="1107" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">show_usage()</text>
    <text x="1107" y="58" font-family="Arial, sans-serif" font-size="8" fill="#e3f2fd">Help & usage display</text>
  </g>
  
  <!-- Layer 2: Configuration System -->
  <g id="config-system" transform="translate(89, 388)">
    <rect x="0" y="0" width="610" height="144" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
    <text x="13" y="21" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#6a1b9a">
      Layer 2: Configuration System (scripts/settings/)
    </text>
    
    <!-- Config loading -->
    <rect x="21" y="34" width="144" height="34" fill="#9c27b0" stroke="#7b1fa2" stroke-width="1" rx="3"/>
    <text x="28" y="47" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">load_config()</text>
    <text x="28" y="58" font-family="Arial, sans-serif" font-size="9" fill="#f3e5f5">Loads defaults + user config</text>
    
    <!-- Config validation -->
    <rect x="186" y="34" width="144" height="34" fill="#9c27b0" stroke="#7b1fa2" stroke-width="1" rx="3"/>
    <text x="193" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">validate_required_config()</text>
    <text x="193" y="58" font-family="Arial, sans-serif" font-size="9" fill="#f3e5f5">Validates required variables</text>
    
    <!-- Config export -->
    <rect x="351" y="34" width="144" height="34" fill="#9c27b0" stroke="#7b1fa2" stroke-width="1" rx="3"/>
    <text x="358" y="47" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">export_config()</text>
    <text x="358" y="58" font-family="Arial, sans-serif" font-size="9" fill="#f3e5f5">Exports to environment</text>
    
    <!-- Variable lifecycle circles -->
    <circle cx="93" cy="89" r="13" fill="#e8f5e8" stroke="#4caf50" stroke-width="2"/>
    <text x="85" y="93" font-family="Arial, sans-serif" font-size="10" font-weight="bold">C</text>
    <text x="28" y="110" font-family="Arial, sans-serif" font-size="9">Config Birth</text>
    
    <circle cx="258" cy="89" r="13" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
    <text x="251" y="93" font-family="Arial, sans-serif" font-size="10" font-weight="bold">V</text>
    <text x="193" y="110" font-family="Arial, sans-serif" font-size="9">Validation Transform</text>
    
    <circle cx="423" cy="89" r="13" fill="#fce4ec" stroke="#e91e63" stroke-width="2"/>
    <text x="417" y="93" font-family="Arial, sans-serif" font-size="10" font-weight="bold">E</text>
    <text x="358" y="110" font-family="Arial, sans-serif" font-size="9">Environment Export</text>
  </g>
  
  <!-- Layer 3: Validation System -->
  <g id="validation-system" transform="translate(720, 388)">
    <rect x="0" y="0" width="631" height="144" fill="#fff8e1" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="13" y="21" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ef6c00">
      Layer 3: Validation System (scripts/lib/validation.sh)
    </text>
    
    <!-- Validation functions -->
    <rect x="21" y="34" width="144" height="34" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="28" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">validate_environment()</text>
    <text x="28" y="58" font-family="Arial, sans-serif" font-size="9" fill="#fff8e1">System prerequisites</text>
    
    <rect x="186" y="34" width="144" height="34" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="193" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">validate_user_configuration()</text>
    <text x="193" y="58" font-family="Arial, sans-serif" font-size="9" fill="#fff8e1">User config validation</text>
    
    <rect x="351" y="34" width="144" height="34" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="358" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">validate_dns_parallel()</text>
    <text x="358" y="58" font-family="Arial, sans-serif" font-size="9" fill="#fff8e1">DNS records validation</text>
    
    <rect x="516" y="34" width="144" height="34" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="523" y="47" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">check_prerequisites()</text>
    <text x="523" y="58" font-family="Arial, sans-serif" font-size="9" fill="#fff8e1">System health checks</text>
    
    <!-- Variable validation flow -->
    <circle cx="93" cy="89" r="13" fill="#fce4ec" stroke="#e91e63" stroke-width="2"/>
    <text x="87" y="93" font-family="Arial, sans-serif" font-size="10" font-weight="bold">V1</text>
    <text x="72" y="110" font-family="Arial, sans-serif" font-size="8">Env Check</text>
    
    <circle cx="258" cy="89" r="13" fill="#fce4ec" stroke="#e91e63" stroke-width="2"/>
    <text x="252" y="93" font-family="Arial, sans-serif" font-size="10" font-weight="bold">V2</text>
    <text x="237" y="110" font-family="Arial, sans-serif" font-size="8">Config Check</text>
    
    <circle cx="423" cy="89" r="13" fill="#fce4ec" stroke="#e91e63" stroke-width="2"/>
    <text x="417" y="93" font-family="Arial, sans-serif" font-size="10" font-weight="bold">V3</text>
    <text x="408" y="110" font-family="Arial, sans-serif" font-size="8">DNS Check</text>
    
    <circle cx="588" cy="89" r="13" fill="#fce4ec" stroke="#e91e63" stroke-width="2"/>
    <text x="582" y="93" font-family="Arial, sans-serif" font-size="10" font-weight="bold">V4</text>
    <text x="567" y="110" font-family="Arial, sans-serif" font-size="8">Health Check</text>
  </g>
  
  <!-- Layer 4: Common Utilities -->
  <g id="common-utilities" transform="translate(89, 553)">
    <rect x="0" y="0" width="1262" height="89" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="13" y="21" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ef6c00">
      Layer 4: Common Utilities (scripts/lib/common.sh)
    </text>
    
    <!-- Logging functions -->
    <rect x="21" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="28" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">setup_logging()</text>
    <text x="28" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Initialize logs</text>
    
    <rect x="131" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="138" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">log_info()</text>
    <text x="138" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Info messages</text>
    
    <rect x="241" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="248" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">log_error()</text>
    <text x="248" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Error handling</text>
    
    <!-- Progress tracking -->
    <rect x="351" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="358" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">start_progress()</text>
    <text x="358" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Progress dots</text>
    
    <rect x="461" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="468" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">stop_progress()</text>
    <text x="468" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">End progress</text>
    
    <!-- Safe execution -->
    <rect x="571" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="578" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">safe_execute()</text>
    <text x="578" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Safe commands</text>
    
    <rect x="681" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="688" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">docker_cmd()</text>
    <text x="688" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Docker wrapper</text>
    
    <!-- Security utilities -->
    <rect x="791" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="798" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">safe_mv()</text>
    <text x="798" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Safe file ops</text>
    
    <rect x="901" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="908" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">generate_password()</text>
    <text x="908" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Secret generation</text>
    
    <!-- Health monitoring -->
    <rect x="1011" y="34" width="120" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="1018" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">wait_for_service_health()</text>
    <text x="1018" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Service health checks</text>
    
    <rect x="1152" y="34" width="89" height="42" fill="#ff9800" stroke="#f57c00" stroke-width="1" rx="3"/>
    <text x="1159" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">log_section()</text>
    <text x="1159" y="58" font-family="Arial, sans-serif" font-size="8" fill="#fff3e0">Section headers</text>
  </g>
  
  <!-- Layer 5: Core Modules -->
  <g id="core-modules" transform="translate(89, 663)">
    <rect x="0" y="0" width="1262" height="144" fill="#e8f5e8" stroke="#388e3c" stroke-width="2" rx="5"/>
    <text x="13" y="21" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2e7d32">
      Layer 5: Core Modules (scripts/core/)
    </text>
    
    <!-- Setup module -->
    <g id="setup-module">
      <rect x="21" y="34" width="189" height="97" fill="#4caf50" stroke="#388e3c" stroke-width="1" rx="3"/>
      <text x="28" y="47" font-family="Arial, sans-serif" font-size="12" fill="white" font-weight="bold">setup.sh</text>
      
      <text x="28" y="61" font-family="Arial, sans-serif" font-size="9" fill="#e8f5e8" font-weight="bold">System Setup Functions:</text>
      <text x="28" y="73" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• harden_host_os()</text>
      <text x="28" y="84" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• setup_service_user()</text>
      <text x="28" y="95" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• setup_container_environment()</text>
      <text x="28" y="106" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• setup_system_timezone()</text>
      <text x="28" y="117" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• run_setup()</text>
    </g>
    
    <!-- Containers module -->
    <g id="containers-module">
      <rect x="231" y="34" width="189" height="97" fill="#4caf50" stroke="#388e3c" stroke-width="1" rx="3"/>
      <text x="238" y="47" font-family="Arial, sans-serif" font-size="12" fill="white" font-weight="bold">containers.sh</text>
      
      <text x="238" y="61" font-family="Arial, sans-serif" font-size="9" fill="#e8f5e8" font-weight="bold">Container Functions:</text>
      <text x="238" y="73" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• setup_supabase_containers()</text>
      <text x="238" y="84" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• setup_n8n_container()</text>
      <text x="238" y="95" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• setup_nginx_container()</text>
      <text x="238" y="106" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• deploy_all_containers()</text>
      <text x="238" y="117" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• add_site() / remove_site()</text>
    </g>
    
    <!-- Variable lifecycle in containers -->
    <g id="container-variables">
      <circle cx="441" cy="55" r="8" fill="#e8f5e8" stroke="#4caf50"/>
      <text x="456" y="59" font-family="Arial, sans-serif" font-size="8">Container Birth</text>
      
      <circle cx="441" cy="76" r="8" fill="#fff3e0" stroke="#ff9800"/>
      <text x="456" y="80" font-family="Arial, sans-serif" font-size="8">Config Transform</text>
      
      <circle cx="441" cy="97" r="8" fill="#fce4ec" stroke="#e91e63"/>
      <text x="456" y="101" font-family="Arial, sans-serif" font-size="8">Health Validation</text>
      
      <circle cx="441" cy="118" r="8" fill="#f3e5f5" stroke="#9c27b0"/>
      <text x="456" y="122" font-family="Arial, sans-serif" font-size="8">Service Ready</text>
    </g>
    
    <!-- SSL module (planned) -->
    <g id="ssl-module">
      <rect x="516" y="34" width="189" height="97" fill="#81c784" stroke="#388e3c" stroke-width="1" rx="3" opacity="0.7"/>
      <text x="523" y="47" font-family="Arial, sans-serif" font-size="12" fill="white" font-weight="bold">ssl.sh (planned)</text>
      
      <text x="523" y="61" font-family="Arial, sans-serif" font-size="9" fill="#e8f5e8" font-weight="bold">SSL Functions:</text>
      <text x="523" y="73" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• configure_ssl_certificates()</text>
      <text x="523" y="84" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• generate_internal_ca()</text>
      <text x="523" y="95" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• setup_letsencrypt()</text>
      <text x="523" y="106" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• renew_certificates()</text>
      <text x="523" y="117" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• validate_ssl_setup()</text>
    </g>
    
    <!-- Backup module (planned) -->
    <g id="backup-module">
      <rect x="726" y="34" width="189" height="97" fill="#81c784" stroke="#388e3c" stroke-width="1" rx="3" opacity="0.7"/>
      <text x="733" y="47" font-family="Arial, sans-serif" font-size="12" fill="white" font-weight="bold">backup.sh (planned)</text>
      
      <text x="733" y="61" font-family="Arial, sans-serif" font-size="9" fill="#e8f5e8" font-weight="bold">Backup Functions:</text>
      <text x="733" y="73" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• create_system_backup()</text>
      <text x="733" y="84" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• backup_databases()</text>
      <text x="733" y="95" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• backup_volumes()</text>
      <text x="733" y="106" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• restore_from_backup()</text>
      <text x="733" y="117" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• cleanup_old_backups()</text>
    </g>
    
    <!-- Utils module (planned) -->
    <g id="utils-module">
      <rect x="936" y="34" width="189" height="97" fill="#81c784" stroke="#388e3c" stroke-width="1" rx="3" opacity="0.7"/>
      <text x="943" y="47" font-family="Arial, sans-serif" font-size="12" fill="white" font-weight="bold">cleanup.sh (planned)</text>
      
      <text x="943" y="61" font-family="Arial, sans-serif" font-size="9" fill="#e8f5e8" font-weight="bold">Cleanup Functions:</text>
      <text x="943" y="73" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• uninstall_system()</text>
      <text x="943" y="84" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• remove_containers()</text>
      <text x="943" y="95" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• cleanup_user_data()</text>
      <text x="943" y="106" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• restore_system_state()</text>
      <text x="943" y="117" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• verify_cleanup()</text>
    </g>
    
    <!-- Status monitoring -->
    <g id="status-module">
      <rect x="1146" y="34" width="89" height="97" fill="#81c784" stroke="#388e3c" stroke-width="1" rx="3" opacity="0.7"/>
      <text x="1153" y="47" font-family="Arial, sans-serif" font-size="9" fill="white" font-weight="bold">status.sh</text>
      <text x="1153" y="58" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">(planned)</text>
      
      <text x="1153" y="73" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• system_status()</text>
      <text x="1153" y="84" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• health_checks()</text>
      <text x="1153" y="95" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• service_status()</text>
      <text x="1153" y="106" font-family="Arial, sans-serif" font-size="8" fill="#e8f5e8">• ssl_status()</text>
    </g>
  </g>
  
  <!-- Data Flow Arrows -->
  
  <!-- Main to Config -->
  <path d="M 137 356 Q 137 378 137 388" stroke="#9c27b0" stroke-width="2" stroke-dasharray="8,4" 
        fill="none" marker-end="url(#arrowhead-purple)"/>
  <text x="150" y="372" font-family="Arial, sans-serif" font-size="8" fill="#9c27b0">load_config()</text>
  
  <!-- Config to Validation -->
  <path d="M 699 460 Q 720 460 720 460" stroke="#4caf50" stroke-width="2" stroke-dasharray="4,2" 
        fill="none" marker-end="url(#arrowhead-green)"/>
  <text x="705" y="450" font-family="Arial, sans-serif" font-size="8" fill="#4caf50">validate</text>
  
  <!-- Main to Core Modules -->
  <path d="M 347 356 Q 347 500 347 663" stroke="#2196f3" stroke-width="2" 
        fill="none" marker-end="url(#arrowhead-blue)"/>
  <text x="355" y="500" font-family="Arial, sans-serif" font-size="8" fill="#2196f3">run_installation()</text>
  
  <path d="M 512 356 Q 512 600 325 663" stroke="#2196f3" stroke-width="2" 
        fill="none" marker-end="url(#arrowhead-blue)"/>
  <text x="400" y="500" font-family="Arial, sans-serif" font-size="8" fill="#2196f3">bash setup.sh</text>
  
  <!-- Core modules to common utilities -->
  <path d="M 231 642 Q 231 630 231 642" stroke="#ff9800" stroke-width="3" fill="none"/>
  <path d="M 325 642 Q 325 630 325 642" stroke="#ff9800" stroke-width="3" fill="none"/>
  <text x="250" y="655" font-family="Arial, sans-serif" font-size="8" fill="#ff9800">logging & error handling</text>
  
  <!-- Configuration data flow path -->
  <rect x="89" y="845" width="1262" height="21" fill="url(#dataFlow)" stroke="#2196f3" rx="5"/>
  <text x="95" y="857" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1565c0">
    Configuration Data Flow: jstack.config → load_config() → validate_*() → export_config() → ALL_MODULES
  </text>
  
  <!-- Error/Logging flow -->
  <text x="95" y="880" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#ff9800">
    Error & Logging Flow: ALL_FUNCTIONS → common.sh → log_*() → SETUP_LOG_FILE
  </text>
</svg>